<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Ruby routes</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_green.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-08-20T18:33:45+08:00">2025-08-20T18:33:45+08:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="green">
  92.56%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1525.57
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>18</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>806</b> relevant lines,
    <span class="green"><b>746</b> lines covered</span> and
    <span class="red"><b>60</b> lines missed. </span>
    (<span class="green">
  92.56%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#64c5081333f28851a0956f6178847deeee1a433e" class="src_link" title="lib/ruby_routes.rb">lib/ruby_routes.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.35</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e06e4798f7653f470022549f6b68cab0f8abdc86" class="src_link" title="lib/ruby_routes/constant.rb">lib/ruby_routes/constant.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.33 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">30</td>
            <td class="cell--number">19</td>
            <td class="cell--number">11</td>
            <td class="cell--number">614.27</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d4a530755223f958cc1b4c660a669819f3e22a07" class="src_link" title="lib/ruby_routes/lru_strategies/hit_strategy.rb">lib/ruby_routes/lru_strategies/hit_strategy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd290c70874a5a725f6500ada7dd17b1da6b14da" class="src_link" title="lib/ruby_routes/lru_strategies/miss_strategy.rb">lib/ruby_routes/lru_strategies/miss_strategy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13.33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ae4b8a2a484a24900c44a362f5c70bf566f529e0" class="src_link" title="lib/ruby_routes/node.rb">lib/ruby_routes/node.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4414.76</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a3da073bdfd0f82c4fe341dd05baafdf3f383d1b" class="src_link" title="lib/ruby_routes/radix_tree.rb">lib/ruby_routes/radix_tree.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">168</td>
            <td class="cell--number">93</td>
            <td class="cell--number">93</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5294.04</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c4b3eeba82e41430033b3ea3104b6b622cf36961" class="src_link" title="lib/ruby_routes/route.rb">lib/ruby_routes/route.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.67 %</td>
            <td class="cell--number">503</td>
            <td class="cell--number">256</td>
            <td class="cell--number">227</td>
            <td class="cell--number">29</td>
            <td class="cell--number">268.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#18bd365e1c6686436c2bb4f15a33a70ef0b44445" class="src_link" title="lib/ruby_routes/route/small_lru.rb">lib/ruby_routes/route/small_lru.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">43</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">785.96</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc898974ba51f0e107a1f7183e082804128f467" class="src_link" title="lib/ruby_routes/route_set.rb">lib/ruby_routes/route_set.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.86 %</td>
            <td class="cell--number">193</td>
            <td class="cell--number">98</td>
            <td class="cell--number">91</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4365.80</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#85c72e7b64dca751f77482a564887a4605169bbc" class="src_link" title="lib/ruby_routes/router.rb">lib/ruby_routes/router.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.11 %</td>
            <td class="cell--number">205</td>
            <td class="cell--number">112</td>
            <td class="cell--number">111</td>
            <td class="cell--number">1</td>
            <td class="cell--number">173.30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4b50faa25a92037c15713cb5fedfbd250ed7ebe5" class="src_link" title="lib/ruby_routes/segment.rb">lib/ruby_routes/segment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1027.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ef95b827752f2eb1cd6b6afe66d090abcd266871" class="src_link" title="lib/ruby_routes/segments/base_segment.rb">lib/ruby_routes/segments/base_segment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">327.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9d444332abbc154c62fbf49c698c1e2ab4532ca7" class="src_link" title="lib/ruby_routes/segments/dynamic_segment.rb">lib/ruby_routes/segments/dynamic_segment.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.33 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">15</td>
            <td class="cell--number">11</td>
            <td class="cell--number">4</td>
            <td class="cell--number">390.93</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b5923d6697450adbcf5bb2a1d1c8b361b9461dd6" class="src_link" title="lib/ruby_routes/segments/static_segment.rb">lib/ruby_routes/segments/static_segment.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">90.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">10</td>
            <td class="cell--number">9</td>
            <td class="cell--number">1</td>
            <td class="cell--number">725.30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1bbcb7d01db2c7f041d2d4ba74e35c62b63b5abb" class="src_link" title="lib/ruby_routes/segments/wildcard_segment.rb">lib/ruby_routes/segments/wildcard_segment.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.47 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">17</td>
            <td class="cell--number">13</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3.06</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f4b9b7c26209691b7673ee4ebac637cd82ebc64" class="src_link" title="lib/ruby_routes/string_extensions.rb">lib/ruby_routes/string_extensions.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.67 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">12</td>
            <td class="cell--number">11</td>
            <td class="cell--number">1</td>
            <td class="cell--number">44.08</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#482ec6f28bf325c9269a95a5b228d936426bf752" class="src_link" title="lib/ruby_routes/url_helpers.rb">lib/ruby_routes/url_helpers.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">74</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">6.95</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ff2aa567278cfa6a01b544cfbc8db0143e75947d" class="src_link" title="lib/ruby_routes/version.rb">lib/ruby_routes/version.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Core">
  <h2>
    <span class="group_name">Core</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         2.35
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Core"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>17</b> relevant lines,
    <span class="green"><b>17</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#64c5081333f28851a0956f6178847deeee1a433e" class="src_link" title="lib/ruby_routes.rb">lib/ruby_routes.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.35</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Router">
  <h2>
    <span class="group_name">Router</span>
    (<span class="covered_percent">
      <span class="green">
  99.11%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         173.3
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Router"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>112</b> relevant lines,
    <span class="green"><b>111</b> lines covered</span> and
    <span class="red"><b>1</b> lines missed. </span>
    (<span class="green">
  99.11%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#85c72e7b64dca751f77482a564887a4605169bbc" class="src_link" title="lib/ruby_routes/router.rb">lib/ruby_routes/router.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.11 %</td>
            <td class="cell--number">205</td>
            <td class="cell--number">112</td>
            <td class="cell--number">111</td>
            <td class="cell--number">1</td>
            <td class="cell--number">173.30</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Routes">
  <h2>
    <span class="group_name">Routes</span>
    (<span class="covered_percent">
      <span class="yellow">
  89.83%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1403.06
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Routes"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>354</b> relevant lines,
    <span class="green"><b>318</b> lines covered</span> and
    <span class="red"><b>36</b> lines missed. </span>
    (<span class="yellow">
  89.83%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c4b3eeba82e41430033b3ea3104b6b622cf36961" class="src_link" title="lib/ruby_routes/route.rb">lib/ruby_routes/route.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.67 %</td>
            <td class="cell--number">503</td>
            <td class="cell--number">256</td>
            <td class="cell--number">227</td>
            <td class="cell--number">29</td>
            <td class="cell--number">268.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc898974ba51f0e107a1f7183e082804128f467" class="src_link" title="lib/ruby_routes/route_set.rb">lib/ruby_routes/route_set.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.86 %</td>
            <td class="cell--number">193</td>
            <td class="cell--number">98</td>
            <td class="cell--number">91</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4365.80</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="TreeSegments">
  <h2>
    <span class="group_name">Tree & Segments</span>
    (<span class="covered_percent">
      <span class="green">
  95.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         3662.31
       </span>
    </span> hits/line
    )
  </h2>

  <a name="TreeSegments"></a>

  <div>
    <b>6</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>180</b> relevant lines,
    <span class="green"><b>171</b> lines covered</span> and
    <span class="red"><b>9</b> lines missed. </span>
    (<span class="green">
  95.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ae4b8a2a484a24900c44a362f5c70bf566f529e0" class="src_link" title="lib/ruby_routes/node.rb">lib/ruby_routes/node.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4414.76</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a3da073bdfd0f82c4fe341dd05baafdf3f383d1b" class="src_link" title="lib/ruby_routes/radix_tree.rb">lib/ruby_routes/radix_tree.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">168</td>
            <td class="cell--number">93</td>
            <td class="cell--number">93</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5294.04</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ef95b827752f2eb1cd6b6afe66d090abcd266871" class="src_link" title="lib/ruby_routes/segments/base_segment.rb">lib/ruby_routes/segments/base_segment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">327.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9d444332abbc154c62fbf49c698c1e2ab4532ca7" class="src_link" title="lib/ruby_routes/segments/dynamic_segment.rb">lib/ruby_routes/segments/dynamic_segment.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.33 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">15</td>
            <td class="cell--number">11</td>
            <td class="cell--number">4</td>
            <td class="cell--number">390.93</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b5923d6697450adbcf5bb2a1d1c8b361b9461dd6" class="src_link" title="lib/ruby_routes/segments/static_segment.rb">lib/ruby_routes/segments/static_segment.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">90.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">10</td>
            <td class="cell--number">9</td>
            <td class="cell--number">1</td>
            <td class="cell--number">725.30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1bbcb7d01db2c7f041d2d4ba74e35c62b63b5abb" class="src_link" title="lib/ruby_routes/segments/wildcard_segment.rb">lib/ruby_routes/segments/wildcard_segment.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.47 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">17</td>
            <td class="cell--number">13</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3.06</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Utilities">
  <h2>
    <span class="group_name">Utilities</span>
    (<span class="covered_percent">
      <span class="green">
  94.64%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         14.91
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Utilities"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>56</b> relevant lines,
    <span class="green"><b>53</b> lines covered</span> and
    <span class="red"><b>3</b> lines missed. </span>
    (<span class="green">
  94.64%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f4b9b7c26209691b7673ee4ebac637cd82ebc64" class="src_link" title="lib/ruby_routes/string_extensions.rb">lib/ruby_routes/string_extensions.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.67 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">12</td>
            <td class="cell--number">11</td>
            <td class="cell--number">1</td>
            <td class="cell--number">44.08</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#482ec6f28bf325c9269a95a5b228d936426bf752" class="src_link" title="lib/ruby_routes/url_helpers.rb">lib/ruby_routes/url_helpers.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">74</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">6.95</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="yellow">
  87.36%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         614.09
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>6</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>87</b> relevant lines,
    <span class="green"><b>76</b> lines covered</span> and
    <span class="red"><b>11</b> lines missed. </span>
    (<span class="yellow">
  87.36%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e06e4798f7653f470022549f6b68cab0f8abdc86" class="src_link" title="lib/ruby_routes/constant.rb">lib/ruby_routes/constant.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.33 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">30</td>
            <td class="cell--number">19</td>
            <td class="cell--number">11</td>
            <td class="cell--number">614.27</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d4a530755223f958cc1b4c660a669819f3e22a07" class="src_link" title="lib/ruby_routes/lru_strategies/hit_strategy.rb">lib/ruby_routes/lru_strategies/hit_strategy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd290c70874a5a725f6500ada7dd17b1da6b14da" class="src_link" title="lib/ruby_routes/lru_strategies/miss_strategy.rb">lib/ruby_routes/lru_strategies/miss_strategy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13.33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#18bd365e1c6686436c2bb4f15a33a70ef0b44445" class="src_link" title="lib/ruby_routes/route/small_lru.rb">lib/ruby_routes/route/small_lru.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">43</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">785.96</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4b50faa25a92037c15713cb5fedfbd250ed7ebe5" class="src_link" title="lib/ruby_routes/segment.rb">lib/ruby_routes/segment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1027.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ff2aa567278cfa6a01b544cfbc8db0143e75947d" class="src_link" title="lib/ruby_routes/version.rb">lib/ruby_routes/version.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="64c5081333f28851a0956f6178847deeee1a433e">
  <div class="header">
    <h3>lib/ruby_routes.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/string_extensions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/route&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/route_set&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/url_helpers&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/router&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/radix_tree&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &quot;ruby_routes/node&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Error &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class RouteNotFound &lt; Error; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class InvalidRoute &lt; Error; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class ConstraintViolation &lt; Error; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">  # Create a new router instance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.new(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    RubyRoutes::Router.new(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">  # Define the routes using a block</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.draw(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="23">
            
              <span class="hits">23</span>
            

            

            <code class="ruby">    RubyRoutes::Router.new(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e06e4798f7653f470022549f6b68cab0f8abdc86">
  <div class="header">
    <h3>lib/ruby_routes/constant.rb</h3>
    <h4>
      <span class="red">
  63.33%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>30</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/dynamic_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/static_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/wildcard_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;lru_strategies/hit_strategy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;lru_strategies/miss_strategy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Constant</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    SEGMENTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      42 =&gt; RubyRoutes::Segments::WildcardSegment,   # &#39;*&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">      58 =&gt; RubyRoutes::Segments::DynamicSegment,    # &#39;:&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">      :default =&gt; RubyRoutes::Segments::StaticSegment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    SEGMENT_MATCHERS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      static: lambda do |node, segment, _idx, _segments, _params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            

            <code class="ruby">        child = node.static_children[segment]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            

            <code class="ruby">        child ? [child, false] : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">      end,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      dynamic: lambda do |node, segment, _idx, _segments, params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            

            <code class="ruby">        return nil unless node.dynamic_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            

            <code class="ruby">        nxt = node.dynamic_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            

            <code class="ruby">        params[nxt.param_name.to_s] = segment if params &amp;&amp; nxt.param_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            

            <code class="ruby">        [nxt, false]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">      end,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">      wildcard: lambda do |node, _segment, idx, segments, params|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            

            <code class="ruby">        return nil unless node.wildcard_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            

            <code class="ruby">        nxt = node.wildcard_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            

            <code class="ruby">        params[nxt.param_name.to_s] = segments[idx..-1].join(&#39;/&#39;) if params &amp;&amp; nxt.param_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            

            <code class="ruby">        [nxt, true]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">      end,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">      # default returns nil (no match). RadixTree#find will then return [nil, {}].</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            

            <code class="ruby">      default: lambda { |_node, _segment, _idx, _segments, _params| nil }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">    # singleton instances to avoid per-LRU allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    LRU_HIT_STRATEGY = RubyRoutes::LruStrategies::HitStrategy.new.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    LRU_MISS_STRATEGY = RubyRoutes::LruStrategies::MissStrategy.new.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">    # Descriptor factories for segment classification (O(1) dispatch by first byte).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    DESCRIPTOR_FACTORIES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="45">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      42 =&gt; -&gt;(s) { { type: :splat,  name: (s[1..-1] || &#39;splat&#39;).freeze } }, # &#39;*&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1205" data-linenumber="46">
            
              <span class="hits">1205</span>
            

            

            <code class="ruby">      58 =&gt; -&gt;(s) { { type: :param,  name:   s[1..-1].freeze } },             # &#39;:&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2469" data-linenumber="47">
            
              <span class="hits">2469</span>
            

            

            <code class="ruby">      :default =&gt; -&gt;(s) { { type: :static, value:  s.freeze } }  # Intern static values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def self.segment_descriptor(raw)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3683" data-linenumber="51">
            
              <span class="hits">3683</span>
            

            

            <code class="ruby">      s = raw.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3683" data-linenumber="52">
            
              <span class="hits">3683</span>
            

            

            <code class="ruby">      key = s.empty? ? :default : s.getbyte(0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3683" data-linenumber="53">
            
              <span class="hits">3683</span>
            

            

            <code class="ruby">      factory = DESCRIPTOR_FACTORIES[key] || DESCRIPTOR_FACTORIES[:default]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3683" data-linenumber="54">
            
              <span class="hits">3683</span>
            

            

            <code class="ruby">      factory.call(s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d4a530755223f958cc1b4c660a669819f3e22a07">
  <div class="header">
    <h3>lib/ruby_routes/lru_strategies/hit_strategy.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module LruStrategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class HitStrategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def call(lru, key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="5">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">        lru.increment_hits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="6">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">        h = lru.instance_variable_get(:@h)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="7">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">        val = h.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="8">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">        h[key] = val</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="9">
            
              <span class="hits">19</span>
            

            

            <code class="ruby">        val</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fd290c70874a5a725f6500ada7dd17b1da6b14da">
  <div class="header">
    <h3>lib/ruby_routes/lru_strategies/miss_strategy.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module LruStrategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class MissStrategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def call(lru, _key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="5">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">        lru.increment_misses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="6">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">        nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ae4b8a2a484a24900c44a362f5c70bf566f529e0">
  <div class="header">
    <h3>lib/ruby_routes/node.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    attr_accessor :static_children, :dynamic_child, :wildcard_child,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">                  :handlers, :param_name, :is_endpoint</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="9">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @static_children = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="10">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @dynamic_child = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="11">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @wildcard_child = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="12">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @handlers = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="13">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @param_name = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="14">
            
              <span class="hits">1137</span>
            

            

            <code class="ruby">      @is_endpoint = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    # Fast traversal: minimal allocations, streamlined branching</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    # Returns [next_node_or_nil, should_break_bool] or [nil, false] if no match.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def traverse_for(segment, index, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      # Static match: O(1) hash lookup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30432" data-linenumber="21">
            
              <span class="hits">30432</span>
            

            

            <code class="ruby">      child = @static_children[segment]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30432" data-linenumber="22">
            
              <span class="hits">30432</span>
            

            

            <code class="ruby">      return [child, false] if child</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">      # Dynamic match: single segment capture</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15181" data-linenumber="25">
            
              <span class="hits">15181</span>
            

            

            <code class="ruby">      if (dyn = @dynamic_child)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15167" data-linenumber="26">
            
              <span class="hits">15167</span>
            

            

            <code class="ruby">        params[dyn.param_name] = segment if params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15167" data-linenumber="27">
            
              <span class="hits">15167</span>
            

            

            <code class="ruby">        return [dyn, false]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">      # Wildcard match: consume remainder (last resort)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="31">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">      if (wild = @wildcard_child)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="32">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        if params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">          # Build remainder path without intermediate array allocation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="34">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">          remainder = segments[index..-1]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="35">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">          params[wild.param_name] = remainder.size == 1 ? remainder[0] : remainder.join(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="37">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        return [wild, true]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">      # No match</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="41">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      [nil, false]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    # Pre-cache param names as strings to avoid repeated .to_s calls</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def param_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15179" data-linenumber="46">
            
              <span class="hits">15179</span>
            

            

            <code class="ruby">      @param_name_str ||= @param_name&amp;.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def param_name=(name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1186" data-linenumber="50">
            
              <span class="hits">1186</span>
            

            

            <code class="ruby">      @param_name = name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1186" data-linenumber="51">
            
              <span class="hits">1186</span>
            

            

            <code class="ruby">      @param_name_str = nil  # invalidate cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">    # Normalize method once and cache string keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def add_handler(method, handler)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1350" data-linenumber="56">
            
              <span class="hits">1350</span>
            

            

            <code class="ruby">      method_key = method.to_s.upcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1350" data-linenumber="57">
            
              <span class="hits">1350</span>
            

            

            <code class="ruby">      @handlers[method_key] = handler</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1350" data-linenumber="58">
            
              <span class="hits">1350</span>
            

            

            <code class="ruby">      @is_endpoint = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def get_handler(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15241" data-linenumber="62">
            
              <span class="hits">15241</span>
            

            

            <code class="ruby">      @handlers[method]  # assume already normalized upstream</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a3da073bdfd0f82c4fe341dd05baafdf3f383d1b">
  <div class="header">
    <h3>lib/ruby_routes/radix_tree.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>93</b> relevant lines.
      <span class="green"><b>93</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class RadixTree</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      # Allow RadixTree.new(path, options...) to act as a convenience factory</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def new(*args, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="320" data-linenumber="8">
            
              <span class="hits">320</span>
            

            

            <code class="ruby">        if args.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="9">
            
              <span class="hits">166</span>
            

            

            <code class="ruby">          RubyRoutes::Route.new(*args, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="11">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">          super()</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="17">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">      @root = Node.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="18">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">      @split_cache = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="19">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">      @split_cache_order = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="20">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">      @split_cache_max = 2048      # larger cache for better hit rates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="21">
            
              <span class="hits">154</span>
            

            

            <code class="ruby">      @empty_segments = [].freeze  # reuse for root path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def add(path, methods, handler)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1318" data-linenumber="25">
            
              <span class="hits">1318</span>
            

            

            <code class="ruby">      current = @root</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1318" data-linenumber="26">
            
              <span class="hits">1318</span>
            

            

            <code class="ruby">      segments = split_path_raw(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1318" data-linenumber="28">
            
              <span class="hits">1318</span>
            

            

            <code class="ruby">      segments.each do |raw_seg|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3590" data-linenumber="29">
            
              <span class="hits">3590</span>
            

            

            <code class="ruby">        seg = RubyRoutes::Segment.for(raw_seg)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3590" data-linenumber="30">
            
              <span class="hits">3590</span>
            

            

            <code class="ruby">        current = seg.ensure_child(current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3590" data-linenumber="31">
            
              <span class="hits">3590</span>
            

            

            <code class="ruby">        break if seg.wildcard?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">      # Normalize methods once during registration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2651" data-linenumber="35">
            
              <span class="hits">2651</span>
            

            

            <code class="ruby">      Array(methods).each { |method| current.add_handler(method.to_s.upcase, handler) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def find(path, method, params_out = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">      # Fast path: root route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15223" data-linenumber="40">
            
              <span class="hits">15223</span>
            

            

            <code class="ruby">      if path == &#39;/&#39; || path.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="41">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">        handler = @root.get_handler(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="42">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">        if @root.is_endpoint &amp;&amp; handler</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="43">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">          return [handler, params_out || {}]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          return [nil, {}]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="49">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      segments = split_path_cached(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="50">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      current = @root</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="51">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      params = params_out || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="52">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      params.clear if params_out</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">      # Unrolled traversal for common case (1-3 segments)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="55">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      case segments.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">      when 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="57">
            
              <span class="hits">42</span>
            

            

            <code class="ruby">        next_node, _ = current.traverse_for(segments[0], 0, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="58">
            
              <span class="hits">42</span>
            

            

            <code class="ruby">        current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">      when 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="60">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">        next_node, should_break = current.traverse_for(segments[0], 0, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="61">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">        return [nil, {}] unless next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="62">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">        current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="63">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">        unless should_break</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="64">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">          next_node, _ = current.traverse_for(segments[1], 1, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15144" data-linenumber="65">
            
              <span class="hits">15144</span>
            

            

            <code class="ruby">          current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">      when 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="68">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        next_node, should_break = current.traverse_for(segments[0], 0, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="69">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        return [nil, {}] unless next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="70">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="71">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        unless should_break</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="72">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">          next_node, should_break = current.traverse_for(segments[1], 1, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="73">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">          return [nil, {}] unless next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="74">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">          current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="75">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">          unless should_break</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="76">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">            next_node, _ = current.traverse_for(segments[2], 2, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="77">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">            current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">        # General case for longer paths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="82">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">        segments.each_with_index do |text, idx|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="83">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">          next_node, should_break = current.traverse_for(text, idx, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="84">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">          return [nil, {}] unless next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="85">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">          current = next_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="86">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">          break if should_break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="90">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      return [nil, {}] unless current</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15209" data-linenumber="91">
            
              <span class="hits">15209</span>
            

            

            <code class="ruby">      handler = current.get_handler(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15209" data-linenumber="92">
            
              <span class="hits">15209</span>
            

            

            <code class="ruby">      return [nil, {}] unless current.is_endpoint &amp;&amp; handler</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">      # Fast constraint check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15200" data-linenumber="95">
            
              <span class="hits">15200</span>
            

            

            <code class="ruby">      if handler.respond_to?(:constraints) &amp;&amp; !handler.constraints.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1020" data-linenumber="96">
            
              <span class="hits">1020</span>
            

            

            <code class="ruby">        return [nil, {}] unless constraints_match_fast(handler.constraints, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15195" data-linenumber="99">
            
              <span class="hits">15195</span>
            

            

            <code class="ruby">      [handler, params]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">    # Cached path splitting with optimized common cases</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def split_path_cached(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="106">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      return @empty_segments if path == &#39;/&#39; || path.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15214" data-linenumber="108">
            
              <span class="hits">15214</span>
            

            

            <code class="ruby">      if (cached = @split_cache[path])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="109">
            
              <span class="hits">16</span>
            

            

            <code class="ruby">        return cached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15198" data-linenumber="112">
            
              <span class="hits">15198</span>
            

            

            <code class="ruby">      result = split_path_raw(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">      # Cache with simple LRU eviction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15198" data-linenumber="115">
            
              <span class="hits">15198</span>
            

            

            <code class="ruby">      @split_cache[path] = result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15198" data-linenumber="116">
            
              <span class="hits">15198</span>
            

            

            <code class="ruby">      @split_cache_order &lt;&lt; path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15198" data-linenumber="117">
            
              <span class="hits">15198</span>
            

            

            <code class="ruby">      if @split_cache_order.size &gt; @split_cache_max</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8904" data-linenumber="118">
            
              <span class="hits">8904</span>
            

            

            <code class="ruby">        oldest = @split_cache_order.shift</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8904" data-linenumber="119">
            
              <span class="hits">8904</span>
            

            

            <code class="ruby">        @split_cache.delete(oldest)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15198" data-linenumber="122">
            
              <span class="hits">15198</span>
            

            

            <code class="ruby">      result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby">    # Raw path splitting without caching (for registration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="126">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def split_path_raw(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16516" data-linenumber="127">
            
              <span class="hits">16516</span>
            

            

            <code class="ruby">      return [] if path == &#39;/&#39; || path.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby">      # Optimized trimming: avoid string allocations when possible</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16495" data-linenumber="130">
            
              <span class="hits">16495</span>
            

            

            <code class="ruby">      start_idx = path.start_with?(&#39;/&#39;) ? 1 : 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16495" data-linenumber="131">
            
              <span class="hits">16495</span>
            

            

            <code class="ruby">      end_idx = path.end_with?(&#39;/&#39;) ? -2 : -1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16495" data-linenumber="133">
            
              <span class="hits">16495</span>
            

            

            <code class="ruby">      if start_idx == 0 &amp;&amp; end_idx == -1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        path.split(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16494" data-linenumber="136">
            
              <span class="hits">16494</span>
            

            

            <code class="ruby">        path[start_idx..end_idx].split(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            

            <code class="ruby">    # Optimized constraint matching with fast paths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def constraints_match_fast(constraints, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1020" data-linenumber="142">
            
              <span class="hits">1020</span>
            

            

            <code class="ruby">      constraints.each do |param, constraint|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            

            <code class="ruby">        # Try both string and symbol keys (common pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1021" data-linenumber="144">
            
              <span class="hits">1021</span>
            

            

            <code class="ruby">        value = params[param.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1021" data-linenumber="145">
            
              <span class="hits">1021</span>
            

            

            <code class="ruby">        value ||= params[param] if param.respond_to?(:to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1021" data-linenumber="146">
            
              <span class="hits">1021</span>
            

            

            <code class="ruby">        next unless value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1021" data-linenumber="148">
            
              <span class="hits">1021</span>
            

            

            <code class="ruby">        case constraint</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">        when Regexp</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="150">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">          return false unless constraint.match?(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            

            <code class="ruby">        when Proc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="152">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          return false unless constraint.call(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            

            <code class="ruby">        when :int</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            

            <code class="ruby">          # Fast integer check without regex</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="155">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">          return false unless value.is_a?(String) &amp;&amp; value.match?(/\A\d+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            

            <code class="ruby">        when :uuid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            

            <code class="ruby">          # Fast UUID check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="158">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          return false unless value.is_a?(String) &amp;&amp; value.length == 36 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby">                             value.match?(/\A[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\z/i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby">        when Symbol</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            

            <code class="ruby">          # Handle other symbolic constraints</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1003" data-linenumber="162">
            
              <span class="hits">1003</span>
            

            

            <code class="ruby">          next  # unknown symbol constraint — allow</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1015" data-linenumber="165">
            
              <span class="hits">1015</span>
            

            

            <code class="ruby">      true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c4b3eeba82e41430033b3ea3104b6b622cf36961">
  <div class="header">
    <h3>lib/ruby_routes/route.rb</h3>
    <h4>
      <span class="yellow">
  88.67%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>256</b> relevant lines.
      <span class="green"><b>227</b> lines covered</span> and
      <span class="red"><b>29</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;uri&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;timeout&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;set&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;route/small_lru&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    attr_reader :path, :methods, :controller, :action, :name, :constraints, :defaults</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="11">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @path = normalize_path(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">      # Pre-normalize and freeze methods at creation time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="13">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      raw_methods = Array(options[:via] || :get)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2751" data-linenumber="14">
            
              <span class="hits">2751</span>
            

            

            <code class="ruby">      @methods = raw_methods.map { |m| normalize_method(m) }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="15">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @methods_set = @methods.to_set.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="16">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @controller = extract_controller(options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="17">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @action = options[:action] || extract_action(options[:to])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="18">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @name = options[:as]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="19">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @constraints = options[:constraints] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      # Pre-normalize defaults to string keys and freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="21">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @defaults = (options[:defaults] || {}).transform_keys(&amp;:to_s).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">      # Pre-compile everything at initialization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="24">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      precompile_route_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="25">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      validate_route!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def match?(request_method, request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">      # Fast method check: use frozen Set for O(1) lookup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="30">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      return false unless @methods_set.include?(request_method.to_s.upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="31">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      !!extract_path_params_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def extract_params(request_path, parsed_qp = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="35">
            
              <span class="hits">39</span>
            

            

            <code class="ruby">      path_params = extract_path_params_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="36">
            
              <span class="hits">39</span>
            

            

            <code class="ruby">      return EMPTY_HASH unless path_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">      # Use optimized param building</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="39">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      build_params_hash(path_params, request_path, parsed_qp)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def named?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1289" data-linenumber="43">
            
              <span class="hits">1289</span>
            

            

            <code class="ruby">      !@name.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def resource?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      @is_resource</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def collection?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="51">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      !@is_resource</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def parse_query_params(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      query_params_fast(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">    # Optimized path generation with better caching and fewer allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_path(params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="60">
            
              <span class="hits">50</span>
            

            

            <code class="ruby">      return ROOT_PATH if @path == ROOT_PATH</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">      # Fast path: empty params and no required params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="48" data-linenumber="63">
            
              <span class="hits">48</span>
            

            

            <code class="ruby">      if params.empty? &amp;&amp; @required_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="64">
            
              <span class="hits">11</span>
            

            

            <code class="ruby">        return @static_path if @static_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">      # Build merged params efficiently</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="68">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      merged = build_merged_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">      # Check required params (fast Set operation)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="71">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      missing_params = @required_params_set - merged.keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="72">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      unless missing_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::RouteNotFound, &quot;Missing params: #{missing_params.to_a.join(&#39;, &#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">      # Check for nil values in required params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="77">
            
              <span class="hits">77</span>
            

            

            <code class="ruby">      nil_params = @required_params_set.select { |param| merged[param].nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="78">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      unless nil_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="79">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        raise RubyRoutes::RouteNotFound, &quot;Missing or nil params: #{nil_params.to_a.join(&#39;, &#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">      # Cache lookup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="83">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">      cache_key = build_cache_key_fast(merged)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="84">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">      if (cached = @gen_cache.get(cache_key))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="85">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">        return cached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">      # Generate path using string buffer (avoid array allocations)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="89">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      path_str = generate_path_string(merged)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="90">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      @gen_cache.set(cache_key, path_str)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="91">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      path_str</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">    # Fast query params method (cached and optimized)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def query_params(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            

            <code class="ruby">      query_params_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby">    # Constants for performance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    EMPTY_HASH = {}.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    ROOT_PATH = &#39;/&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    UNRESERVED_RE = /\A[a-zA-Z0-9\-._~]+\z/.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    QUERY_CACHE_SIZE = 128</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">    # Common HTTP methods - interned for performance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_GET = &#39;GET&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_POST = &#39;POST&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="110">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_PUT = &#39;PUT&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_PATCH = &#39;PATCH&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_DELETE = &#39;DELETE&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_HEAD = &#39;HEAD&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    HTTP_OPTIONS = &#39;OPTIONS&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">    # Fast method normalization using interned constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def normalize_method(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1384" data-linenumber="118">
            
              <span class="hits">1384</span>
            

            

            <code class="ruby">      case method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="857" data-linenumber="119">
            
              <span class="hits">857</span>
            

            

            <code class="ruby">      when :get then HTTP_GET</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="120">
            
              <span class="hits">146</span>
            

            

            <code class="ruby">      when :post then HTTP_POST</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="121">
            
              <span class="hits">126</span>
            

            

            <code class="ruby">      when :put then HTTP_PUT</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="122">
            
              <span class="hits">125</span>
            

            

            <code class="ruby">      when :patch then HTTP_PATCH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="123">
            
              <span class="hits">126</span>
            

            

            <code class="ruby">      when :delete then HTTP_DELETE</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            

            <code class="ruby">      when :head then HTTP_HEAD</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      when :options then HTTP_OPTIONS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="126">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      else method.to_s.upcase.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby">    # Pre-compile all route data at initialization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="131">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def precompile_route_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="132">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @is_resource = @path.match?(/\/:id(?:$|\.)/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="133">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @gen_cache = SmallLru.new(512)  # larger cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="134">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @query_cache = SmallLru.new(QUERY_CACHE_SIZE)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="136">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      compile_segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="137">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      compile_required_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="138">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      check_static_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def compile_segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="142">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @compiled_segments = if @path == ROOT_PATH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="143">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">                             EMPTY_ARRAY</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            

            <code class="ruby">                           else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1347" data-linenumber="145">
            
              <span class="hits">1347</span>
            

            

            <code class="ruby">                             @path.split(&#39;/&#39;).reject(&amp;:empty?).map do |seg|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3683" data-linenumber="146">
            
              <span class="hits">3683</span>
            

            

            <code class="ruby">                               RubyRoutes::Constant.segment_descriptor(seg)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby">                             end.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            

            <code class="ruby">                           end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="151">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def compile_required_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5050" data-linenumber="152">
            
              <span class="hits">5050</span>
            

            

            <code class="ruby">      param_names = @compiled_segments.filter_map { |s| s[:name] if s[:type] != :static }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="153">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @param_names = param_names.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2581" data-linenumber="154">
            
              <span class="hits">2581</span>
            

            

            <code class="ruby">      @required_params = param_names.reject { |n| @defaults.key?(n) }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="155">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      @required_params_set = @required_params.to_set.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def check_static_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby">      # Pre-generate static paths (no params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="160">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      if @required_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="490" data-linenumber="161">
            
              <span class="hits">490</span>
            

            

            <code class="ruby">        @static_path = generate_static_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="165">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_static_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="490" data-linenumber="166">
            
              <span class="hits">490</span>
            

            

            <code class="ruby">      return ROOT_PATH if @compiled_segments.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1193" data-linenumber="168">
            
              <span class="hits">1193</span>
            

            

            <code class="ruby">      parts = @compiled_segments.map { |seg| seg[:value] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="470" data-linenumber="169">
            
              <span class="hits">470</span>
            

            

            <code class="ruby">      &quot;/#{parts.join(&#39;/&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            

            <code class="ruby">    # Optimized param building</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def build_params_hash(path_params, request_path, parsed_qp)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            

            <code class="ruby">      # Use pre-allocated hash when possible</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="175">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      result = get_thread_local_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            

            <code class="ruby">      # Path params first (highest priority)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="178">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      result.update(path_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            

            <code class="ruby">      # Query params (if needed)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="181">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      if parsed_qp</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            

            

            <code class="ruby">        result.merge!(parsed_qp)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="183">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      elsif request_path.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            

            

            <code class="ruby">        qp = query_params_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            

            

            <code class="ruby">        result.merge!(qp) unless qp.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            

            <code class="ruby">      # Defaults (lowest priority)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="189">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      merge_defaults_fast(result) unless @defaults.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            

            <code class="ruby">      # Validate constraints efficiently</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="192">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      validate_constraints_fast!(result) unless @constraints.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="194">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      result.dup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="197">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def get_thread_local_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            

            <code class="ruby">      # Use a pool of hashes to reduce allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="199">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      pool = Thread.current[:ruby_routes_hash_pool] ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="200">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      if pool.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="201">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">        {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            

            

            <code class="ruby">        hash = pool.pop</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            

            

            <code class="ruby">        hash.clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="205">
            

            

            <code class="ruby">        hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="209">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def return_hash_to_pool(hash)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            

            

            <code class="ruby">      pool = Thread.current[:ruby_routes_hash_pool] ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            

            

            <code class="ruby">      pool.push(hash) if pool.size &lt; 5  # Keep pool small to avoid memory bloat</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def merge_defaults_fast(result)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="215">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      @defaults.each { |k, v| result[k] = v unless result.key?(k) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            

            <code class="ruby">    # Fast path parameter extraction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="219">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def extract_path_params_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="220">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      return EMPTY_HASH if @compiled_segments.empty? &amp;&amp; request_path == ROOT_PATH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="221">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      return nil if @compiled_segments.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            

            <code class="ruby">      # Fast path normalization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="224">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      path_parts = split_path_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            

            <code class="ruby">      # Check if we have a wildcard/splat segment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="149" data-linenumber="227">
            
              <span class="hits">149</span>
            

            

            <code class="ruby">      has_splat = @compiled_segments.any? { |seg| seg[:type] == :splat }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="229">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      if has_splat</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            

            <code class="ruby">        # For wildcard routes, path can have more parts than segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="231">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">        return nil if path_parts.size &lt; @compiled_segments.size - 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            

            <code class="ruby">        # For non-wildcard routes, size must match exactly</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="234">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">        return nil if @compiled_segments.size != path_parts.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="237">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">      extract_params_from_parts(path_parts)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="240">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def split_path_fast(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            

            <code class="ruby">      # Optimized path splitting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="242">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      path = request_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="243">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      path = path[1..-1] if path.start_with?(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="244">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      path = path[0...-1] if path.end_with?(&#39;/&#39;) &amp;&amp; path != ROOT_PATH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="245">
            
              <span class="hits">45</span>
            

            

            <code class="ruby">      path.empty? ? [] : path.split(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="248">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def extract_params_from_parts(path_parts)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="249">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">      params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="251">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">      @compiled_segments.each_with_index do |seg, idx|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="252">
            
              <span class="hits">91</span>
            

            

            <code class="ruby">        case seg[:type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            

            <code class="ruby">        when :static</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="254">
            
              <span class="hits">47</span>
            

            

            <code class="ruby">          return nil unless seg[:value] == path_parts[idx]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            

            <code class="ruby">        when :param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="256">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">          params[seg[:name]] = path_parts[idx]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            

            <code class="ruby">        when :splat</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="258">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">          params[seg[:name]] = path_parts[idx..-1].join(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="259">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">          break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="263">
            
              <span class="hits">40</span>
            

            

            <code class="ruby">      params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            

            <code class="ruby">    # Optimized merged params building</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="267">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def build_merged_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="268">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">      return @defaults if params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="270">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      merged = get_thread_local_merged_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            

            <code class="ruby">      # Merge defaults first if they exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="273">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      merged.update(@defaults) unless @defaults.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            

            <code class="ruby">      # Use merge! with transform_keys for better performance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="276">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      if params.respond_to?(:transform_keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="277">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">        merged.merge!(params.transform_keys(&amp;:to_s))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            

            <code class="ruby">        # Fallback for older Ruby versions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="280">
            

            

            <code class="ruby">        params.each { |k, v| merged[k.to_s] = v }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="283">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      merged</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="286">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def get_thread_local_merged_hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="287">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      hash = Thread.current[:ruby_routes_merged] ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="288">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      hash.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="289">
            
              <span class="hits">36</span>
            

            

            <code class="ruby">      hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            

            <code class="ruby">    # Fast cache key building with minimal allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="293">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def build_cache_key_fast(merged)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="294">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">      return &#39;&#39; if @required_params.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            

            <code class="ruby">      # Use array join which is faster than string concatenation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="297">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">      parts = @required_params.map do |name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="298">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">        value = merged[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="299">
            
              <span class="hits">37</span>
            

            

            <code class="ruby">        value.is_a?(Array) ? value.join(&#39;/&#39;) : value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="301">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">      parts.join(&#39;|&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            

            <code class="ruby">    # Optimized path generation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="305">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_path_string(merged)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="306">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      return ROOT_PATH if @compiled_segments.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            

            <code class="ruby">      # Pre-allocate array for parts to avoid string buffer operations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="309">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      parts = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="311">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      @compiled_segments.each do |seg|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="312">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">        case seg[:type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            

            <code class="ruby">        when :static</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="314">
            
              <span class="hits">31</span>
            

            

            <code class="ruby">          parts &lt;&lt; seg[:value]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            

            <code class="ruby">        when :param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="316">
            
              <span class="hits">30</span>
            

            

            <code class="ruby">          value = merged.fetch(seg[:name]).to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="317">
            
              <span class="hits">30</span>
            

            

            <code class="ruby">          parts &lt;&lt; encode_segment_fast(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            

            <code class="ruby">        when :splat</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="319">
            

            

            <code class="ruby">          value = merged.fetch(seg[:name], &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="320">
            

            

            <code class="ruby">          parts &lt;&lt; format_splat_value(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            

            <code class="ruby">      # Single join operation is faster than multiple string concatenations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="325">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      path = &quot;/#{parts.join(&#39;/&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="326">
            
              <span class="hits">27</span>
            

            

            <code class="ruby">      path == &#39;/&#39; ? ROOT_PATH : path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="329">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def format_splat_value(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="330">
            

            

            <code class="ruby">      case value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            

            <code class="ruby">      when Array</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="332">
            

            

            <code class="ruby">        value.map { |part| encode_segment_fast(part.to_s) }.join(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            

            <code class="ruby">      when String</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="334">
            

            

            <code class="ruby">        value.split(&#39;/&#39;).map { |part| encode_segment_fast(part) }.join(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="336">
            

            

            <code class="ruby">        encode_segment_fast(value.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            

            <code class="ruby">    # Fast segment encoding with caching for common values</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="341">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def encode_segment_fast(str)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="342">
            
              <span class="hits">30</span>
            

            

            <code class="ruby">      return str if UNRESERVED_RE.match?(str)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            

            <code class="ruby">      # Cache encoded segments to avoid repeated encoding</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="345">
            

            

            <code class="ruby">      @encoding_cache ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="346">
            

            

            <code class="ruby">      @encoding_cache[str] ||= URI.encode_www_form_component(str)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            

            <code class="ruby">    # Optimized query params with caching</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="350">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def query_params_fast(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="351">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      query_start = path.index(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="352">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return EMPTY_HASH unless query_start</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="354">
            

            

            <code class="ruby">      query_string = path[(query_start + 1)..-1]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="355">
            

            

            <code class="ruby">      return EMPTY_HASH if query_string.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            

            <code class="ruby">      # Cache query param parsing</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="358">
            

            

            <code class="ruby">      if (cached = @query_cache.get(query_string))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="359">
            

            

            <code class="ruby">        return cached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="362">
            

            

            <code class="ruby">      result = Rack::Utils.parse_query(query_string)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="363">
            

            

            <code class="ruby">      @query_cache.set(query_string, result)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="364">
            

            

            <code class="ruby">      result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="367">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def normalize_path(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="368">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      path_str = path.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="369">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      path_str = &quot;/#{path_str}&quot; unless path_str.start_with?(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="370">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      path_str = path_str.chomp(&#39;/&#39;) unless path_str == ROOT_PATH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="371">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      path_str</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="374">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def extract_controller(options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="375">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      to = options[:to]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="376">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      return options[:controller] unless to</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1361" data-linenumber="377">
            
              <span class="hits">1361</span>
            

            

            <code class="ruby">      to.to_s.split(&#39;#&#39;, 2).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="380">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def extract_action(to)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1364" data-linenumber="381">
            
              <span class="hits">1364</span>
            

            

            <code class="ruby">      return nil unless to</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1361" data-linenumber="382">
            
              <span class="hits">1361</span>
            

            

            <code class="ruby">      to.to_s.split(&#39;#&#39;, 2).last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            

            <code class="ruby">    # Optimized constraint validation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="386">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def validate_constraints_fast!(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="387">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">      @constraints.each do |param, constraint|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="388">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">        value = params[param.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            

            <code class="ruby">        # Only skip validation if the parameter is completely missing from params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            

            <code class="ruby">        # Empty strings and nil values should still be validated</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="391">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">        next unless params.key?(param.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="392">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="393">
            
              <span class="hits">28</span>
            

            

            <code class="ruby">        case constraint</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            

            <code class="ruby">        when Regexp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            

            <code class="ruby">          # Protect against ReDoS attacks with timeout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="396">
            

            

            <code class="ruby">          begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="397">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">            Timeout.timeout(0.1) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="398">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">              raise RubyRoutes::ConstraintViolation unless constraint.match?(value.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            

            <code class="ruby">          rescue Timeout::Error</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="401">
            

            

            <code class="ruby">            raise RubyRoutes::ConstraintViolation, &quot;Regex constraint timed out (potential ReDoS attack)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="402">
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            

            <code class="ruby">        when Proc</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            

            <code class="ruby">          # DEPRECATED: Proc constraints are deprecated due to security risks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="405">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">          warn_proc_constraint_deprecation(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="406">
            

            

            <code class="ruby">          </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            

            

            <code class="ruby">          # For backward compatibility, still execute but with strict timeout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="408">
            

            

            <code class="ruby">          begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="409">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">            Timeout.timeout(0.05) do  # Reduced timeout for security</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="410">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">              raise RubyRoutes::ConstraintViolation unless constraint.call(value.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="411">
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="412">
            

            

            <code class="ruby">          rescue Timeout::Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="413">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">            raise RubyRoutes::ConstraintViolation, &quot;Proc constraint timed out (consider using secure alternatives)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            

            

            <code class="ruby">          rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="415">
            

            

            <code class="ruby">            raise RubyRoutes::ConstraintViolation, &quot;Proc constraint failed: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="416">
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="417">
            

            

            <code class="ruby">        when :int</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="418">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="419">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.match?(/\A\d+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            

            <code class="ruby">        when :uuid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="421">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="422">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.length == 36 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="423">
            

            

            <code class="ruby">                 value_str.match?(/\A[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\z/i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="424">
            

            

            <code class="ruby">        when :email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="425">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="426">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.match?(/\A[^@\s]+@[^@\s]+\.[^@\s]+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="427">
            

            

            <code class="ruby">        when :slug</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="428">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="429">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.match?(/\A[a-z0-9]+(?:-[a-z0-9]+)*\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="430">
            

            

            <code class="ruby">        when :alpha</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="431">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="432">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.match?(/\A[a-zA-Z]+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="433">
            

            

            <code class="ruby">        when :alphanumeric</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="434">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          value_str = value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="435">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          raise RubyRoutes::ConstraintViolation unless value_str.match?(/\A[a-zA-Z0-9]+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            

            <code class="ruby">        when Hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="437">
            

            

            <code class="ruby">          # Secure hash-based constraints for common patterns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="438">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">          validate_hash_constraint!(constraint, value_str = value.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="443">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def warn_proc_constraint_deprecation(param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="444">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      return if @proc_warnings_shown&amp;.include?(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="446">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @proc_warnings_shown ||= Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="447">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @proc_warnings_shown &lt;&lt; param</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="448">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="449">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      warn &lt;&lt;~WARNING</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="450">
            

            

            <code class="ruby">        [DEPRECATION] Proc constraints are deprecated due to security risks.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="452">
            

            

            <code class="ruby">        Parameter: #{param}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="453">
            

            

            <code class="ruby">        Route: #{@path}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="454">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="455">
            

            

            <code class="ruby">        Secure alternatives:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="456">
            

            

            <code class="ruby">        - Use regex: constraints: { #{param}: /\\A\\d+\\z/ }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="457">
            

            

            <code class="ruby">        - Use built-in types: constraints: { #{param}: :int }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="458">
            

            

            <code class="ruby">        - Use hash constraints: constraints: { #{param}: { min_length: 3, format: /\\A[a-z]+\\z/ } }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="459">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="460">
            

            

            <code class="ruby">        Available built-in types: :int, :uuid, :email, :slug, :alpha, :alphanumeric</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="462">
            

            

            <code class="ruby">        This warning will become an error in a future version.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="463">
            

            

            <code class="ruby">      WARNING</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="464">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="465">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="466">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def validate_hash_constraint!(constraint, value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="467">
            

            

            <code class="ruby">      # Secure hash-based constraints</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="468">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      if constraint[:min_length] &amp;&amp; value.length &lt; constraint[:min_length]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="469">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value too short (minimum #{constraint[:min_length]} characters)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="470">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="471">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="472">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      if constraint[:max_length] &amp;&amp; value.length &gt; constraint[:max_length]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="473">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value too long (maximum #{constraint[:max_length]} characters)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="474">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="476">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      if constraint[:format] &amp;&amp; !value.match?(constraint[:format])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="477">
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value does not match required format&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="478">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="479">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="480">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">      if constraint[:in] &amp;&amp; !constraint[:in].include?(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="481">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value not in allowed list&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="482">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="483">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="484">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      if constraint[:not_in] &amp;&amp; constraint[:not_in].include?(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="485">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value in forbidden list&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="486">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="487">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="488">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      if constraint[:range] &amp;&amp; !constraint[:range].cover?(value.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="489">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise RubyRoutes::ConstraintViolation, &quot;Value not in allowed range&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="490">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="491">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="492">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="493">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def validate_route!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1367" data-linenumber="494">
            
              <span class="hits">1367</span>
            

            

            <code class="ruby">      raise InvalidRoute, &quot;Controller is required&quot; if @controller.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1364" data-linenumber="495">
            
              <span class="hits">1364</span>
            

            

            <code class="ruby">      raise InvalidRoute, &quot;Action is required&quot; if @action.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1363" data-linenumber="496">
            
              <span class="hits">1363</span>
            

            

            <code class="ruby">      raise InvalidRoute, &quot;Invalid HTTP method: #{@methods}&quot; if @methods.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="497">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="498">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="499">
            

            

            <code class="ruby">    # Additional constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="500">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    EMPTY_ARRAY = [].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="501">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    EMPTY_STRING = &#39;&#39;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="502">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="503">
            

            

            <code class="ruby"> end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="18bd365e1c6686436c2bb4f15a33a70ef0b44445">
  <div class="header">
    <h3>lib/ruby_routes/route/small_lru.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Route</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">    # small LRU used for path generation cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class SmallLru</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      attr_reader :hits, :misses, :evictions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">      # larger default to reduce eviction likelihood in benchmarks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize(max_size = 1024)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="9">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @max_size = max_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="10">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @h = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="11">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @hits = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="12">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @misses = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="13">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @evictions = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="15">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @hit_strategy = RubyRoutes::Constant::LRU_HIT_STRATEGY</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2761" data-linenumber="16">
            
              <span class="hits">2761</span>
            

            

            <code class="ruby">        @miss_strategy = RubyRoutes::Constant::LRU_MISS_STRATEGY</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def get(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="20">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        strategy = @h.key?(key) ? @hit_strategy : @miss_strategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="21">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        strategy.call(self, key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def set(key, val)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="25">
            
              <span class="hits">211</span>
            

            

            <code class="ruby">        @h.delete(key) if @h.key?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="26">
            
              <span class="hits">211</span>
            

            

            <code class="ruby">        @h[key] = val</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="27">
            
              <span class="hits">211</span>
            

            

            <code class="ruby">        if @h.size &gt; @max_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="28">
            
              <span class="hits">55</span>
            

            

            <code class="ruby">          @h.shift</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="29">
            
              <span class="hits">55</span>
            

            

            <code class="ruby">          @evictions += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="31">
            
              <span class="hits">211</span>
            

            

            <code class="ruby">        val</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def increment_hits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="35">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">        @hits += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def increment_misses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="39">
            
              <span class="hits">39</span>
            

            

            <code class="ruby">        @misses += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cbc898974ba51f0e107a1f7183e082804128f467">
  <div class="header">
    <h3>lib/ruby_routes/route_set.rb</h3>
    <h4>
      <span class="green">
  92.86%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>98</b> relevant lines.
      <span class="green"><b>91</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class RouteSet</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    attr_reader :routes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="6">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @tree = RubyRoutes::RadixTree.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="7">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @named_routes = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="8">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @routes = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">      # Optimized recognition cache with better data structures</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="10">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @recognition_cache = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="11">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @cache_hits = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="12">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @cache_misses = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="13">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      @recognition_cache_max = 8192  # larger for better hit rates</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def add_route(route)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="17">
            
              <span class="hits">1287</span>
            

            

            <code class="ruby">      @routes &lt;&lt; route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="18">
            
              <span class="hits">1287</span>
            

            

            <code class="ruby">      @tree.add(route.path, route.methods, route)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="19">
            
              <span class="hits">1287</span>
            

            

            <code class="ruby">      @named_routes[route.name] = route if route.named?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      # Clear recognition cache when routes change</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="21">
            
              <span class="hits">1287</span>
            

            

            <code class="ruby">      @recognition_cache.clear if @recognition_cache.size &gt; 100</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="22">
            
              <span class="hits">1287</span>
            

            

            <code class="ruby">      route</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def find_route(request_method, request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">      # Optimized: avoid repeated string allocation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="27">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      method_up = request_method.to_s.upcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="28">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      handler, _params = @tree.find(request_path, method_up)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="29">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      handler</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def find_named_route(name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="33">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">      route = @named_routes[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="34">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">      return route if route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="35">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      raise RouteNotFound, &quot;No route named &#39;#{name}&#39;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def match(request_method, request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">      # Fast path: normalize method once</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30107" data-linenumber="40">
            
              <span class="hits">30107</span>
            

            

            <code class="ruby">      method_up = method_lookup(request_method)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">      # Optimized cache key: avoid string interpolation when possible</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30107" data-linenumber="43">
            
              <span class="hits">30107</span>
            

            

            <code class="ruby">      cache_key = build_cache_key(method_up, request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">      # Cache hit: return immediately (cached result includes full structure)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30107" data-linenumber="46">
            
              <span class="hits">30107</span>
            

            

            <code class="ruby">      if (cached_result = @recognition_cache[cache_key])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17931" data-linenumber="47">
            
              <span class="hits">17931</span>
            

            

            <code class="ruby">        @cache_hits += 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17931" data-linenumber="48">
            
              <span class="hits">17931</span>
            

            

            <code class="ruby">        return cached_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12176" data-linenumber="51">
            
              <span class="hits">12176</span>
            

            

            <code class="ruby">      @cache_misses += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">      # Use thread-local params to avoid allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12176" data-linenumber="54">
            
              <span class="hits">12176</span>
            

            

            <code class="ruby">      params = get_thread_local_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12176" data-linenumber="55">
            
              <span class="hits">12176</span>
            

            

            <code class="ruby">      handler, _ = @tree.find(request_path, method_up, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12176" data-linenumber="56">
            
              <span class="hits">12176</span>
            

            

            <code class="ruby">      return nil unless handler</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="58">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      route = handler</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby">      # Fast path: merge defaults only if they exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="61">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      merge_defaults(route, params) if route.defaults &amp;&amp; !route.defaults.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">      # Fast path: parse query params only if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="64">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      if request_path.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            

            <code class="ruby">        merge_query_params(route, request_path, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">      # Create return hash and cache the complete result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="69">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      result_params = params.dup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">      result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="71">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">        route: route,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">        params: result_params,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">        controller: route.controller,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">        action: route.action</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">      }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="77">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      insert_cache_entry(cache_key, result)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="78">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def recognize_path(path, method = :get)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="82">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      match(method, path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_path(name, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="86">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      route = @named_routes[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="87">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      if route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="88">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">        route.generate_path(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        raise RouteNotFound, &quot;No route named &#39;#{name}&#39;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_path_from_route(route, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="95">
            
              <span class="hits">30</span>
            

            

            <code class="ruby">      route.generate_path(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def clear!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="99">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @routes.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="100">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @named_routes.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="101">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @recognition_cache.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="102">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @tree = RadixTree.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="103">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      @cache_hits = @cache_misses = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="107">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      @routes.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    alias_method :length, :size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="112">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      @routes.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="115">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def each(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="116">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      return enum_for(:each) unless block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      @routes.each(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="120">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def include?(route)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @routes.include?(route)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            

            <code class="ruby">    # Performance monitoring</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def cache_stats</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="126">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      total = @cache_hits + @cache_misses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="127">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      hit_rate = total &gt; 0 ? (@cache_hits.to_f / total * 100).round(2) : 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="129">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">        hits: @cache_hits,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            

            <code class="ruby">        misses: @cache_misses,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            

            <code class="ruby">        hit_rate: &quot;#{hit_rate}%&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby">        size: @recognition_cache.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            

            <code class="ruby">    # Method lookup table to avoid repeated upcasing with interned strings</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def method_lookup(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30150" data-linenumber="140">
            
              <span class="hits">30150</span>
            

            

            <code class="ruby">      @method_cache ||= Hash.new { |h, k| h[k] = k.to_s.upcase.freeze }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30107" data-linenumber="141">
            
              <span class="hits">30107</span>
            

            

            <code class="ruby">      @method_cache[method]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            

            <code class="ruby">    # Optimized cache key building - avoid string interpolation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="145">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def build_cache_key(method, path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            

            <code class="ruby">      # Use string interpolation which is faster than buffer + dup + freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby">      # String interpolation creates a new string directly without intermediate allocations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32107" data-linenumber="148">
            
              <span class="hits">32107</span>
            

            

            <code class="ruby">      &quot;#{method}:#{path}&quot;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            

            <code class="ruby">    # Get thread-local params hash, reusing when possible</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="152">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def get_thread_local_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            

            <code class="ruby">      # Use single thread-local hash that gets cleared, avoiding pool management overhead</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13176" data-linenumber="154">
            
              <span class="hits">13176</span>
            

            

            <code class="ruby">      hash = Thread.current[:ruby_routes_params_hash] ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13176" data-linenumber="155">
            
              <span class="hits">13176</span>
            

            

            <code class="ruby">      hash.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13176" data-linenumber="156">
            
              <span class="hits">13176</span>
            

            

            <code class="ruby">      hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="159">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def return_params_to_pool(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby">      # No-op since we&#39;re using a single reusable hash per thread</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            

            <code class="ruby">    # Fast defaults merging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def merge_defaults(route, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="165">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      route.defaults.each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="166">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        params[key] = value unless params.key?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            

            <code class="ruby">    # Fast query params merging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="171">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def merge_query_params(route, request_path, params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            

            

            <code class="ruby">      if route.respond_to?(:parse_query_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            

            

            <code class="ruby">        qp = route.parse_query_params(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            

            

            <code class="ruby">        params.merge!(qp) unless qp.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            

            

            <code class="ruby">      elsif route.respond_to?(:query_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            

            

            <code class="ruby">        qp = route.query_params(request_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            

            

            <code class="ruby">        params.merge!(qp) unless qp.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            

            <code class="ruby">    # Efficient cache insertion with LRU eviction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="182">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def insert_cache_entry(cache_key, cache_entry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="183">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      @recognition_cache[cache_key] = cache_entry</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            

            <code class="ruby">      # Simple eviction: clear cache when it gets too large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12165" data-linenumber="186">
            
              <span class="hits">12165</span>
            

            

            <code class="ruby">      if @recognition_cache.size &gt; @recognition_cache_max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            

            <code class="ruby">        # Keep most recently used half</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="188">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        keys_to_delete = @recognition_cache.keys[0...(@recognition_cache_max / 2)]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4097" data-linenumber="189">
            
              <span class="hits">4097</span>
            

            

            <code class="ruby">        keys_to_delete.each { |k| @recognition_cache.delete(k) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="85c72e7b64dca751f77482a564887a4605169bbc">
  <div class="header">
    <h3>lib/ruby_routes/router.rb</h3>
    <h4>
      <span class="green">
  99.11%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>112</b> relevant lines.
      <span class="green"><b>111</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Router</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    attr_reader :route_set</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="6">
            
              <span class="hits">53</span>
            

            

            <code class="ruby">      @route_set = RouteSet.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="7">
            
              <span class="hits">53</span>
            

            

            <code class="ruby">      @scope_stack = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="8">
            
              <span class="hits">53</span>
            

            

            <code class="ruby">      @concerns = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="9">
            
              <span class="hits">53</span>
            

            

            <code class="ruby">      instance_eval(&amp;block) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    # Basic route definition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def get(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="662" data-linenumber="14">
            
              <span class="hits">662</span>
            

            

            <code class="ruby">      add_route(path, options.merge(via: :get))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def post(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="128" data-linenumber="18">
            
              <span class="hits">128</span>
            

            

            <code class="ruby">      add_route(path, options.merge(via: :post))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def put(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="22">
            
              <span class="hits">125</span>
            

            

            <code class="ruby">      add_route(path, options.merge(via: :put))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def patch(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="26">
            
              <span class="hits">125</span>
            

            

            <code class="ruby">      add_route(path, options.merge(via: :patch))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def delete(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="30">
            
              <span class="hits">126</span>
            

            

            <code class="ruby">      add_route(path, options.merge(via: :delete))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def match(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="34">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">      add_route(path, options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">    # Resources routing (Rails-like)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def resources(name, options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="39">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      singular = name.to_s.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="40">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      plural = (options[:path] || name.to_s.pluralize)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="41">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      controller = options[:controller] || plural</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">      # Collection routes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="44">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      get &quot;/#{plural}&quot;, options.merge(to: &quot;#{controller}#index&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="45">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      get &quot;/#{plural}/new&quot;, options.merge(to: &quot;#{controller}#new&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="46">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      post &quot;/#{plural}&quot;, options.merge(to: &quot;#{controller}#create&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">      # Member routes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="49">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      get &quot;/#{plural}/:id&quot;, options.merge(to: &quot;#{controller}#show&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="50">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      get &quot;/#{plural}/:id/edit&quot;, options.merge(to: &quot;#{controller}#edit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="51">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      put &quot;/#{plural}/:id&quot;, options.merge(to: &quot;#{controller}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="52">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      patch &quot;/#{plural}/:id&quot;, options.merge(to: &quot;#{controller}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="53">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      delete &quot;/#{plural}/:id&quot;, options.merge(to: &quot;#{controller}#destroy&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">      # Nested resources if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="56">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      if options[:nested]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        nested_name = options[:nested]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        nested_singular = nested_name.to_s.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        nested_plural = nested_name.to_s.pluralize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        get &quot;/#{plural}/:id/#{nested_plural}&quot;, options.merge(to: &quot;#{nested_plural}#index&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        get &quot;/#{plural}/:id/#{nested_plural}/new&quot;, options.merge(to: &quot;#{nested_plural}#new&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        post &quot;/#{plural}/:id/#{nested_plural}&quot;, options.merge(to: &quot;#{nested_plural}#create&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        get &quot;/#{plural}/:id/#{nested_plural}/:nested_id&quot;, options.merge(to: &quot;#{nested_plural}#show&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        get &quot;/#{plural}/:id/#{nested_plural}/:nested_id/edit&quot;, options.merge(to: &quot;#{nested_plural}#edit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        put &quot;/#{plural}/:id/#{nested_plural}/:nested_id&quot;, options.merge(to: &quot;#{nested_plural}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        patch &quot;/#{plural}/:id/#{nested_plural}/:nested_id&quot;, options.merge(to: &quot;#{nested_plural}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        delete &quot;/#{plural}/:id/#{nested_plural}/:nested_id&quot;, options.merge(to: &quot;#{nested_plural}#destroy&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">      # Handle concerns if block is given</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="72">
            
              <span class="hits">122</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">        # Push a scope for nested resources</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="74">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        @scope_stack.push({ path: &quot;/#{plural}/:id&quot; })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">        # Execute the block in the context of this router instance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="76">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="77">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        @scope_stack.pop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def resource(name, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      singular = name.to_s.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      get &quot;/#{singular}&quot;, options.merge(to: &quot;#{singular}#show&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      get &quot;/#{singular}/new&quot;, options.merge(to: &quot;#{singular}#new&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      post &quot;/#{singular}&quot;, options.merge(to: &quot;#{singular}#create&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      get &quot;/#{singular}/edit&quot;, options.merge(to: &quot;#{singular}#edit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="88">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      put &quot;/#{singular}&quot;, options.merge(to: &quot;#{singular}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      patch &quot;/#{singular}&quot;, options.merge(to: &quot;#{singular}#update&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      delete &quot;/#{singular}&quot;, options.merge(to: &quot;#{singular}#destroy&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">    # Namespace support</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def namespace(name, options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="95">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">      @scope_stack.push({ path: &quot;/#{name}&quot;, module: name })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="97">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="98">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="101">
            
              <span class="hits">38</span>
            

            

            <code class="ruby">      @scope_stack.pop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">    # Scope support</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def scope(options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="106">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">      @scope_stack.push(options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="108">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="109">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="112">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">      @scope_stack.pop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">    # Root route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def root(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="117">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">      add_route(&quot;/&quot;, options.merge(via: :get))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">    # Concerns (reusable route groups)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def concerns(*names, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="122">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">      names.each do |name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="123">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        concern = @concerns[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="124">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">        raise &quot;Concern &#39;#{name}&#39; not found&quot; unless concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="126">
            
              <span class="hits">16</span>
            

            

            <code class="ruby">        instance_eval(&amp;concern)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="129">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def concern(name, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="135">
            
              <span class="hits">16</span>
            

            

            <code class="ruby">      @concerns[name] = block</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            

            <code class="ruby">    # Route constraints</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def constraints(constraints = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @scope_stack.push({ constraints: constraints })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="146">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @scope_stack.pop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            

            <code class="ruby">    # Defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def defaults(defaults = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="151">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @scope_stack.push({ defaults: defaults })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="154">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        instance_eval(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="157">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @scope_stack.pop</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            

            <code class="ruby">    # Mount other applications</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def mount(app, at: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="162">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      path = at || &quot;/#{app}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="163">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      add_route(&quot;#{path}/*path&quot;, to: app, via: :all)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="166">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def add_route(path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            

            <code class="ruby">      # Apply current scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="170">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      scoped_options = apply_scope(path, options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            

            <code class="ruby">      # Create and add the route</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="173">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      route = Route.new(scoped_options[:path], scoped_options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="174">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      @route_set.add_route(route)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="175">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      route</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="178">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def apply_scope(path, options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="179">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      scoped_options = options.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="180">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      scoped_path = path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="182">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      @scope_stack.reverse_each do |scope|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="864" data-linenumber="183">
            
              <span class="hits">864</span>
            

            

            <code class="ruby">        if scope[:path]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="847" data-linenumber="184">
            
              <span class="hits">847</span>
            

            

            <code class="ruby">          scoped_path = &quot;#{scope[:path]}#{scoped_path}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="864" data-linenumber="187">
            
              <span class="hits">864</span>
            

            

            <code class="ruby">        if scope[:module] &amp;&amp; scoped_options[:to]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="188">
            
              <span class="hits">396</span>
            

            

            <code class="ruby">          controller = scoped_options[:to].to_s.split(&#39;#&#39;).first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="189">
            
              <span class="hits">396</span>
            

            

            <code class="ruby">          scoped_options[:to] = &quot;#{scope[:module]}/#{controller}##{scoped_options[:to].to_s.split(&#39;#&#39;).last}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="864" data-linenumber="192">
            
              <span class="hits">864</span>
            

            

            <code class="ruby">        if scope[:constraints]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="193">
            
              <span class="hits">15</span>
            

            

            <code class="ruby">          scoped_options[:constraints] = (scoped_options[:constraints] || {}).merge(scope[:constraints])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="864" data-linenumber="196">
            
              <span class="hits">864</span>
            

            

            <code class="ruby">        if scope[:defaults]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="197">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          scoped_options[:defaults] = (scoped_options[:defaults] || {}).merge(scope[:defaults])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="201">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      scoped_options[:path] = scoped_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1200" data-linenumber="202">
            
              <span class="hits">1200</span>
            

            

            <code class="ruby">      scoped_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4b50faa25a92037c15713cb5fedfbd250ed7ebe5">
  <div class="header">
    <h3>lib/ruby_routes/segment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/base_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/dynamic_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/static_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;segments/wildcard_segment&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;constant&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class Segment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def self.for(text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3593" data-linenumber="10">
            
              <span class="hits">3593</span>
            

            

            <code class="ruby">      t = text.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3593" data-linenumber="11">
            
              <span class="hits">3593</span>
            

            

            <code class="ruby">      key = t.empty? ? :default : t.getbyte(0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3593" data-linenumber="12">
            
              <span class="hits">3593</span>
            

            

            <code class="ruby">      segment = RubyRoutes::Constant::SEGMENTS[key] || RubyRoutes::Constant::SEGMENTS[:default]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3593" data-linenumber="13">
            
              <span class="hits">3593</span>
            

            

            <code class="ruby">      segment.new(t)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def wildcard?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ef95b827752f2eb1cd6b6afe66d090abcd266871">
  <div class="header">
    <h3>lib/ruby_routes/segments/base_segment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class BaseSegment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize(text = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="5">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        @text = text.to_s if text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def wildcard?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3587" data-linenumber="9">
            
              <span class="hits">3587</span>
            

            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def ensure_child(current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise NotImplementedError, &quot;#{self.class}#ensure_child must be implemented&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def match(_node, _text, _idx, _segments, _params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise NotImplementedError, &quot;#{self.class}#match must be implemented&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9d444332abbc154c62fbf49c698c1e2ab4532ca7">
  <div class="header">
    <h3>lib/ruby_routes/segments/dynamic_segment.rb</h3>
    <h4>
      <span class="red">
  73.33%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>15</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class DynamicSegment &lt; BaseSegment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize(text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1174" data-linenumber="5">
            
              <span class="hits">1174</span>
            

            

            <code class="ruby">        @name = text[1..-1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def ensure_child(current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1171" data-linenumber="9">
            
              <span class="hits">1171</span>
            

            

            <code class="ruby">        current.dynamic_child ||= Node.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1171" data-linenumber="10">
            
              <span class="hits">1171</span>
            

            

            <code class="ruby">        current = current.dynamic_child</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1171" data-linenumber="11">
            
              <span class="hits">1171</span>
            

            

            <code class="ruby">        current.param_name = @name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1171" data-linenumber="12">
            
              <span class="hits">1171</span>
            

            

            <code class="ruby">        current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def match(node, text, _idx, _segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            

            <code class="ruby">        return [nil, false] unless node.dynamic_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            

            <code class="ruby">        nxt = node.dynamic_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            

            <code class="ruby">        params[nxt.param_name.to_s] = text if params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            

            <code class="ruby">        [nxt, false]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b5923d6697450adbcf5bb2a1d1c8b361b9461dd6">
  <div class="header">
    <h3>lib/ruby_routes/segments/static_segment.rb</h3>
    <h4>
      <span class="yellow">
  90.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class StaticSegment &lt; BaseSegment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize(text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2417" data-linenumber="5">
            
              <span class="hits">2417</span>
            

            

            <code class="ruby">        @text = text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def ensure_child(current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2415" data-linenumber="9">
            
              <span class="hits">2415</span>
            

            

            <code class="ruby">        current.static_children[@text] ||= Node.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2415" data-linenumber="10">
            
              <span class="hits">2415</span>
            

            

            <code class="ruby">        current.static_children[@text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def match(node, text, _idx, _segments, _params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            

            <code class="ruby">        [node.static_children[text], false]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1bbcb7d01db2c7f041d2d4ba74e35c62b63b5abb">
  <div class="header">
    <h3>lib/ruby_routes/segments/wildcard_segment.rb</h3>
    <h4>
      <span class="red">
  76.47%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Segments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class WildcardSegment &lt; BaseSegment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize(text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">        @name = (text[1..-1] || &#39;splat&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def ensure_child(current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="9">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        current.wildcard_child ||= Node.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="10">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        current = current.wildcard_child</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="11">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        current.param_name = @name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="12">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def wildcard?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="16">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def match(node, _text, idx, segments, params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            

            <code class="ruby">        return [nil, false] unless node.wildcard_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            

            <code class="ruby">        nxt = node.wildcard_child</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            

            <code class="ruby">        params[nxt.param_name.to_s] = segments[idx..-1].join(&#39;/&#39;) if params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            

            <code class="ruby">        [nxt, true]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4f4b9b7c26209691b7673ee4ebac637cd82ebc64">
  <div class="header">
    <h3>lib/ruby_routes/string_extensions.rb</h3>
    <h4>
      <span class="green">
  91.67%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class String</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def singularize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="3">
            
              <span class="hits">133</span>
            

            

            <code class="ruby">    case self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">    when /ies$/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="5">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      self.sub(/ies$/, &#39;y&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">    when /s$/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="7">
            
              <span class="hits">123</span>
            

            

            <code class="ruby">      self.sub(/s$/, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="9">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def pluralize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="14">
            
              <span class="hits">130</span>
            

            

            <code class="ruby">    case self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    when /y$/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      self.sub(/y$/, &#39;ies&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    when /sh$/, /ch$/, /x$/, /z$/</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            

            <code class="ruby">      self + &#39;es&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">    when /s$/</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      # Words ending in &#39;s&#39; are already plural</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="21">
            
              <span class="hits">123</span>
            

            

            <code class="ruby">      self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="23">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">      self + &#39;s&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="482ec6f28bf325c9269a95a5b228d936426bf752">
  <div class="header">
    <h3>lib/ruby_routes/url_helpers.rb</h3>
    <h4>
      <span class="green">
  95.45%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;cgi&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module UrlHelpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="6">
            
              <span class="hits">31</span>
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def url_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="11">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        @url_helpers ||= Module.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def add_url_helper(name, route)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        url_helpers.define_method(name) do |*args|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            

            <code class="ruby">          params = args.first || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            

            <code class="ruby">          route_set.generate_path_from_route(route, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def url_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      self.class.url_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def path_to(name, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="27">
            
              <span class="hits">25</span>
            

            

            <code class="ruby">      route = route_set.find_named_route(name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="28">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      route_set.generate_path_from_route(route, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def url_to(name, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      path = path_to(name, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="33">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;http://localhost#{path}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def link_to(name, text, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="37">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      path = path_to(name, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      safe_path = CGI.escapeHTML(path.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="39">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      safe_text = CGI.escapeHTML(text.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      &quot;&lt;a href=\&quot;#{safe_path}\&quot;&gt;#{safe_text}&lt;/a&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def button_to(name, text, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="44">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      local_params = params ? params.dup : {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="45">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      method = local_params.delete(:method) || :post</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="46">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      method = method.to_s.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="47">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      path = path_to(name, local_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">      # HTML forms only support GET and POST</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">      # For other methods, use POST with _method hidden field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="51">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      form_method = (method == &#39;get&#39;) ? &#39;get&#39; : &#39;post&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="53">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      safe_path = CGI.escapeHTML(path.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="54">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      safe_form_method = CGI.escapeHTML(form_method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="55">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      html = &quot;&lt;form action=\&quot;#{safe_path}\&quot; method=\&quot;#{safe_form_method}\&quot;&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">      # Add _method hidden field for non-GET/POST methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="58">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      if method != &#39;get&#39; &amp;&amp; method != &#39;post&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="59">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        safe_method = CGI.escapeHTML(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="60">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">        html += &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;_method\&quot; value=\&quot;#{safe_method}\&quot;&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="63">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      safe_text = CGI.escapeHTML(text.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="64">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      html += &quot;&lt;button type=\&quot;submit\&quot;&gt;#{safe_text}&lt;/button&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="65">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      html += &quot;&lt;/form&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="66">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">      html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def redirect_to(name, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="70">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      path = path_to(name, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="71">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      { status: 302, location: path }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ff2aa567278cfa6a01b544cfbc8db0143e75947d">
  <div class="header">
    <h3>lib/ruby_routes/version.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module RubyRoutes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  VERSION = &quot;2.0.0&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
